
# NEMS Database with Cooling Technology Type and water source types

This repository contains two main scripts, `ct_map_initial_NEMS.py` and `NEMS_Unit_coolingwatertech_processing.py`. The first script serves to automate the mapping process of unit-level cooling technology/water source data from **EIA cooling dataset** to **NEMS database**, with some supplementary datasets mentioned below. The second script creates the updated ready-to-use unit database file for ReEDS 2.0. It adds columns for cooling technology type (`ctt`), water source type (`wst`), and `ctt`/`wst`-based new technologies (`coolingwatertech`). Please note that `ctt` and `ct` are interchangeably used.

## `ct_map_initial_NEMS.py`

This script creates `ct_wst_pca_region_code_map_NEMS.csv`, which is currently just an unused intermediate cooling data mapping file, created to follow the format of the cooling technology mapping file `ct_pca_region_code_map.csv` in heritage ReEDS.

 - Following listed database files from **NEMS**, **ABB**, **EIA**, **UCS**, and **USGS** _must_ be in `inputs/` directory; currently `inputs/VentyxUnitData -Full.csv` is _not_ in the repo because of size limit, can be found in the [ABB_Velocity_Suite_Updates](https://github.nrel.gov/ReEDS/ABB_Velocity_Suite_Updates) or nrelqnap02 location (\\\nrelqnap02\ReEDS\\_ReEDS Documentation\NEMS_Unit_Database_Water_Sources).
   - `ReEDS_generator_database_final_EIA-NEMS.csv` 
   - `UCS-EW3-Energy-Water-Database.xlsx`: Refer to [The UCS EW3 Energy-Water Database Published May 4, 2012](https://www.ucsusa.org/sites/default/files/attach/2016/03/UCS-EW3-Energy-Water-Database.xlsx)
   - `cooling_detail_2017.xlsx`: Refer to [Thermoelectric cooling water data](https://www.eia.gov/electricity/data/water/)
   - `2___Plant_Y2018.xlsx`: Refer to [Form EIA-860 detailed data with previous form data (EIA-860A/860B)](https://www.eia.gov/electricity/data/eia860/); helps add missing water source data
   - `3_1_Generator_Y2018.xlsx`: Refer to [Form EIA-860 detailed data with previous form data (EIA-860A/860B)](https://www.eia.gov/electricity/data/eia860/); helps append nameplate capacity column to `cooling_detail_2017.xlsx`
   - `NEMS to ReEDS Tech Mapping_default cts.xlsx`
   - `VentyxUnitData -Full.csv`: used to assign FIPS code to some units, as NEMS database doesn't have latitude/longitude data of all units
   - `NEMS_index_FIPS.csv`: latitude/longitude to FIPS code mapping file, commented in `ct_map_initial_NEMS.py`, since **NEMS database** does not have FIPS code but latitude and longitude
   - `allowable_ct_mapper.csv`: contains allowable cooling technology (ct) from ReEDS definitions. All violating ct assignments should be defaulted to ReEDS-default cooling technology
   - `usco2015v2.0.xlsx`: [Estimated Use of Water in the United States County-Level Data for 2015](https://www.sciencebase.gov/catalog/item/5af3311be4b0da30c1b245d8); contains USGS' county-wise database that has water sources data for municipal and power plants uses. It is used to determine the most common water source types within categories
- Run the `ct_map_initial_NEMS.py` file!
- Various intermediate output files are made to be printed in `outputs/` directory. Default is `output_intermediates = False`, if intermediate files are not required to see.
- The final mapped output file is `ct_wst_pca_region_code_map_NEMS.csv`!

## `NEMS_Unit_coolingwatertech_processing.py`

This script, an extended version of the previous script `ct_map_initial_NEMS.py`, creates the ready-to-use unit database for ReEDS 2.0 with `coolingwatertech`, `ctt`, and `wst` columns. It uses additional file `i_new.csv`, generated by running `coolingtech_process_IO.py` located inside `coolingtech/`. It is setup to automagically run `coolingtech_process_IO.py` in background. The files generated and associated by the subprocess are:
  - `i_new.csv`: new set of technologies with possible cooling technology type (`ctt`) and water source type (`wst`)
  - `i_new_linkage.csv`: linking set between `i_new` indices with its `numeraire` technologies, `i_new`, `ctt`, `wst`; used in GAMS as a linking set to extract the information contained within `i_new`
  - `R2_cw_subsets.xlsx`: raw file containing numeraire technologies and allowable cooling technologies and possible water source types
  - `tech_ctt_wst.csv`, `tech_ctt_wst_nnlimited.csv`: reformatted `R2_cw_subsets.xlsx`; actual file used to map allowable `ctt` and `wst` for numeraire technologies

Though only `i_new.csv` file is used in the process above, the generated files are prepared for other auxiliary functions of cooling water formulations. These files can be generated manually by running `coolingtech_process_IO.py`, and they required to be copied into `ReEDS-2.0/inputs/waterclimate/` for ReEDS 2.0 water climate analysis.

The final output of this script (`NEMS_Unit_coolingwatertech_processing.py`) is unit database file is `ReEDS_generator_database_final_EIA-NEMS.csv`, in the root directory. Please note that the output file is created using `inputs/ReEDS_generator_database_final_EIA-NEMS.csv` by appending/mapping some columns, and make sure that you use `ReEDS_generator_database_final_EIA-NEMS.csv` from main directory, not from `inputs/` to run ReEDS 2.0.

## Remarks and Caveats

 - The online year and service end year have not been considered in assigning default `ctt`.
 - **Attn: Non-ReEDS users!**: Individual Gas-CT units of Gas-CC plants are provided with cooling technology same as of other steam units in **EIA cooling dataset**. In ReEDS 2.0, we plan to enforce that to `none` by constraints or multipliers, to preserve origin source data. For other purposes, make sure Gas-CT unit of gas-CC has no cooling techs.

## Cooling tech type nomenclature

 - `o` = once through
 - `r` = recirculating
 - `p` = pond cooled
 - `d` = dry cooled
 - `n` = no cooling (or generic placeholder)

## Water source type nomenclature

 - `fsu` = fresh surface water that is unappropriated (formerly Unappropriated)*
 - `fsa` = fresh surface water that is appropriated (formerly Appropriated)
 - `fsl` = fresh surface lake (help capture inherent features of lake, overshadowed by fsa otherwise)
 - `fg` = fresh groundwater (formerly Potable Groundwater)
 - `sg` = brackish or saline groundwater (formerly Brackish Groundwater)
 - `ss` = saline surface water (new category)
 - `ww` = wastewater effluent (formerly Wastewater)
 - `n` = no water source available (or generic placeholder :: **removed**)

*It has been swapped with fsa, based on the discussion with Stuart.

**Note**: Location of files [\\\nrelqnap02\ReEDS\\_ReEDS Documentation\NEMS_Unit_Database_Water_Sources]
